<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Registro de Trator</title>
  <link rel="manifest" href="manifest.json">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>
  <style>
    body { font-family: Arial; margin: 20px; background: #f8f9fa; }
    input, select, button { margin: 5px 0; padding: 8px; width: 100%; font-size: 14px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { border: 1px solid #000; padding: 6px; text-align: center; }
    button { cursor: pointer; background: #007bff; color: white; border: none; border-radius: 5px; }
    button:hover { background: #0056b3; }
    #mensagem { margin-top: 15px; padding: 10px; border-radius: 5px; font-weight: bold; text-align: center; display: none; }
    .sucesso { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .erro { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .botoes-acoes { display: flex; gap: 10px; margin-top: 10px; }
    .btn-apagar { background: #dc3545; }
    .btn-apagar:hover { background: #b02a37; }
  </style>
</head>
<body>

<h2>üöú Registro de Trator</h2>

<label>Data:</label>
<input type="date" id="data">

<label>Operador:</label>
<input type="text" id="operador" placeholder="Nome do operador">

<label>Associado:</label>
<input type="text" id="associado" placeholder="Nome do associado">

<label>Modelo do Trator:</label>
<input type="text" id="modelo" placeholder="Ex: Massey Ferguson 275">

<label>Atividade:</label>
<input type="text" id="atividade" placeholder="Ex: Aragem, transporte, pulveriza√ß√£o">

<label>Hor√≠metro Inicial:</label>
<input type="number" id="horimetroInicial" step="0.01" min="0">

<label>Hor√≠metro Final:</label>
<input type="number" id="horimetroFinal" step="0.01" min="0">

<div class="botoes-acoes">
  <button onclick="registrar()">Registrar</button>
  <button onclick="exportarCSV()">Exportar CSV</button>
  <button class="btn-apagar" onclick="limparTodos()">Apagar Tudo</button>
</div>

<div id="mensagem"></div>

<table id="tabela">
  <thead>
    <tr>
      <th>Data</th>
      <th>Operador</th>
      <th>Associado</th>
      <th>Modelo</th>
      <th>Atividade</th>
      <th>Hor√≠metro Inicial</th>
      <th>Hor√≠metro Final</th>
      <th>Horas Trabalhadas</th>
      <th>A√ß√µes</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let registros = JSON.parse(localStorage.getItem("registrosTrator")) || [];

function salvarLocal() {
  localStorage.setItem("registrosTrator", JSON.stringify(registros));
}

function calcularHorasTrabalhadas(hIni, hFim) {
  let horas = hFim - hIni;
  return horas < 0 ? 0 : horas.toFixed(2);
}

function mostrarMensagem(texto, tipo) {
  const msg = document.getElementById("mensagem");
  msg.textContent = texto;
  msg.className = tipo;
  msg.style.display = "block";
}

function registrar() {
  const novoRegistro = {
    data: document.getElementById("data").value,
    operador: document.getElementById("operador").value.trim(),
    associado: document.getElementById("associado").value.trim(),
    modelo: document.getElementById("modelo").value.trim(),
    atividade: document.getElementById("atividade").value.trim(),
    horimetroInicial: parseFloat(document.getElementById("horimetroInicial").value),
    horimetroFinal: parseFloat(document.getElementById("horimetroFinal").value)
  };

  novoRegistro.horasTrabalhadas = calcularHorasTrabalhadas(novoRegistro.horimetroInicial, novoRegistro.horimetroFinal);

  registros.push(novoRegistro);
  salvarLocal();
  atualizarTabela();

  document.querySelectorAll("input").forEach(i => i.value = "");
  mostrarMensagem("Registro salvo!", "sucesso");
}

function atualizarTabela() {
  const tbody = document.querySelector("#tabela tbody");
  tbody.innerHTML = "";
  registros.forEach((r, index) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.data}</td>
      <td>${r.operador}</td>
      <td>${r.associado}</td>
      <td>${r.modelo}</td>
      <td>${r.atividade}</td>
      <td>${r.horimetroInicial}</td>
      <td>${r.horimetroFinal}</td>
      <td>${r.horasTrabalhadas}</td>
      <td><button class="btn-apagar" onclick="apagarRegistro(${index})">Apagar</button></td>
    `;
    tbody.appendChild(tr);
  });
}

function apagarRegistro(i) {
  registros.splice(i, 1);
  salvarLocal();
  atualizarTabela();
}

atualizarTabela();
</script>

</body>
</html>
